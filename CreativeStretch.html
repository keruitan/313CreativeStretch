<!DOCTYPE html>
<!--
/------------------------------------------------------------------------------\
| Copyright (C) 2012-2013 Leap Motion, Inc. All rights reserved.               |
| Leap Motion proprietary and confidential. Not for distribution.              |
| Use subject to the terms of the Leap Motion SDK Agreement available at       |
| https://developer.leapmotion.com/sdk_agreement, or another agreement         |
| between Leap Motion and you, your company or other organization.             |
\------------------------------------------------------------------------------/
-->

<!--

See additional libraries, guides, and examples at:

 - https://developer.leapmotion.com/downloads/javascript
 - https://developer.leapmotion.com/getting-started/javascript
 - https://developer.leapmotion.com/gallery/tags/javascript

-->

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Leap Motion Creative Stretch</title>
<script src="leap-0.6.4.js"></script>
<script src="https://js.leapmotion.com/leap-0.6.4.js"></script>
</head>

<body>
<!--<div>
<img id="source" src = "https://www.publicdomainpictures.net/pictures/40000/velka/red-theater-curtains.jpg"
  width=100% height=100% z-index:"-2">
</div>-->
<!--<h1>Leap Motion Creative Stretch</h1>-->
 <!--<canvas id="canvas" width="800" height="600"></canvas>-->
<div style="display:none;">
  <img id="source" src="./200px-Pac_Man.svg.png"
       width="300" height="227">
</div>
<!--
 <div id="main">
  <button id="pause" onclick="togglePause()">Pause</button>
  <input type="checkbox" id="pauseOnGesture" onclick="pauseForGestures()">Pause on gesture</input>
  <h3>Frame data:</h3>
  <div id="frameData"></div>
  <div style="clear:both;"></div>
  <h3>Hand data:</h3>
  <div id="handData"></div>
  <div style="clear:both;"></div>
  <h3>Finger and tool data:</h3>
  <div id="pointableData"></div>
  <div style="clear:both;"></div>
  <h3>Gesture data:</h3>
  <div id="gestureData"></div>
</div> -->

</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r82/three.js"></script>
<script src="https://js.leapmotion.com/leap-plugins-0.1.12.js"></script>
<script src="OrbitControls.js"></script>


<!-- This is the BoneHand Stuff -->
<script type="text/javascript">
	Leap.loop()
	//    .use('transform', {vr: true})
	    .use('boneHand', {
	      targetEl: document.body,
	      arm: false,
	      opacity: 0.8
	    });

	var scene    = Leap.loopController.plugins.boneHand.scene;
  var camera   = Leap.loopController.plugins.boneHand.camera;
  var renderer = Leap.loopController.plugins.boneHand.renderer;
  /*var plane = new THREE.Mesh(
    new THREE.PlaneGeometry(80,80),
    new THREE.MeshPhongMaterial({wireframe: false, side: THREE.DoubleSide})
  );
  plane.scale.set(2,2,2);
  plane.position.set(0,200,-100);
  plane.receiveShadow = true;
  scene.add(plane);*/
  //camera.lookAt( plane.position );
  //var axisHelper = new THREE.AxisHelper( 100 );
  //scene.add( axisHelper );
  var controls = new THREE.OrbitControls( camera, renderer.domElement );

  Leap.loopController.on('handFound', function(hand) {
    document.querySelector('canvas').style.display = 'block';
  }).on('handLost', function(hand){
    if (Leap.loopController.frame(0).hands.length === 0){
      document.querySelector('canvas').style.display = 'none';
    }
  });
  //document.getElementById('view-source').href = "view-source:" + window.location.href
</script>

<!--Here is the Movement stuff-->
<script type="text/javascript">
	var puppets = {};

	Leap.loop(function(frame) {

	  frame.hands.forEach(function(hand, index) {
	    var cat = ( puppets[0] || (puppets[0] = new Cat()) );
      var pacman = ( puppets[1] || (puppets[1] = new Pacman()) );
      //var pirate = ( puppets[2] || (puppets[2] = new Pirate()) );

      //if a user's hand is in a fist, the boneHands will disappear
      if(hand.grabStrength > .9){
        console.log("inside grabstrenght")
        document.querySelector('canvas').style.display = 'none';
      }

      if(hand.type == "right" && hand.palmPosition[2] < 0){  // && equalPosn(pacman)){
          //  .use('boneHand', {
  	      //  targetEl: document.body,
  	      //  arm: false,
  	      //  opacity: 0
  	      // };
        pacman.setTransform(hand.screenPosition(), hand.roll(), 25, 23);}

      //if it's your left hand, move the cat
      if(hand.type == "left" && hand.palmPosition[2] < 0){ // && equalPosn(cat)){
         console.log("moving cat (left hand)");
	       cat.setTransform(hand.screenPosition(), hand.roll(), 25, 23);}


	  });

	}).use('screenPosition', {scale: 0.25});


  var Cat = function() {
    var cat = this;
    var img = document.createElement('img');
    img.src = 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/109794/cat_2.png';
    img.style.position = 'absolute';

    img.onload = function () {
      cat.setTransform([window.innerWidth/7, window.innerHeight - window.innerHeight*(1/6)], 0, 10, 8);
      document.body.appendChild(img);
    }

    cat.setTransform = function(position, rotation, height, width) {

      img.style.left = position[0] - img.width  / 2 + 'px';
      img.style.top  = position[1] - img.height / 2 + 'px';
      img.style.height = height + "%";
      img.style.width = width + "%";

      img.style.transform = 'rotate(' + -rotation + 'rad)';

      img.style.webkitTransform = img.style.MozTransform = img.style.msTransform =
      img.style.OTransform = img.style.transform;

    };

  };

  var Pacman = function() {
    var pacman = this;
    var img = document.createElement('img');
    img.src = './200px-Pac_Man.svg.png';
    img.style.position = 'absolute';
    img.onload = function () {
      pacman.setTransform([window.innerWidth*.9,window.innerHeight - window.innerHeight*(1/6)], 0, 10, 8);
      document.body.appendChild(img);
    }

    pacman.setTransform = function(position, rotation, height, width) {

      img.style.left = position[0] - img.width  / 2 + 'px';
      img.style.top  = position[1] - img.height / 2 + 'px';
      img.style.height = height + "%";
      img.style.width = width + "%";

      img.style.transform = 'rotate(' + -rotation + 'rad)';

      img.style.webkitTransform = img.style.MozTransform = img.style.msTransform =
      img.style.OTransform = img.style.transform;

    };
  };

    var Pirate = function() {
  	  var pirate = this;
  	  var img = document.createElement('img');
  	  img.src = 'https://www.nickgowman.com/wp-content/uploads/2017/02/fierce-cartoon-pirate.png';
  	  img.style.position = 'absolute';

  	  img.onload = function () {
  	    pirate.setTransform([window.innerWidth*.33, window.innerHeight - window.innerHeight*(1/6)], 0, 10, 8);
  	    document.body.appendChild(img);
  	  }

  	  pirate.setTransform = function(position, rotation, height, width) {

  	    img.style.left = position[0] - img.width  / 2 + 'px';
  	    img.style.top  = position[1] - img.height / 2 + 'px';
        img.style.height = height + "%";
        img.style.width = width + "%";

  	    img.style.transform = 'rotate(' + -rotation + 'rad)';

  	    img.style.webkitTransform = img.style.MozTransform = img.style.msTransform =
  	    img.style.OTransform = img.style.transform;

  	  };

  	};


//returns true if hand.screenPosition == position of object
  equalPosn = function(object){
    var obj = object.getBoundingClientRect();
    var objPosn = [obj.left, obj.top];

    var handLeft = hand.screenPosition[0];
    var handTop = hand.screenPosition[1];
    var handPosn = [handLeft, handTop];

    if(objPosn == handPosn){return true;}
    else{return false;}
  };



	//cats[0] = new Cat();
	//cats[1] = new Pacman();
	//cats[2] = new Pirate();

	// This allows us to move the cat even whilst in an iFrame.
	Leap.loopController.setBackground(true)
</script>

</html>
